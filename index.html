<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>OCM MVRV + BTC Price</title> 
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
  <style>
    #chart {
      position: relative;
      width: 100%;
      max-width: 900px;
      height: 500px;
      margin: auto;
      background-image: url('logo.png');
      background-repeat: no-repeat;
      background-position: center center;
      background-size: contain;
    }
  </style>
</head>
<body style="margin:0; background-color:#18181D; color:white; font-family:Inter, sans-serif;">
  <div id="chart"></div>

  <script>
  const field = "mvrv";

  const showError = (msg) => {
    document.getElementById("chart").innerHTML =
      `<p style="color:red; text-align:center;">⚠️ ${msg}</p>`;
  };

  fetch("/api/market_value_to_realized_value.js")
    .then(res => {
      if (!res.ok) throw new Error('MVRV API status: ' + res.status);
      return res.json();
    })
    .then(result => {
      const data = result.data;
      if (!data || !Array.isArray(data)) {
        throw new Error("MVRV: Unexpected response format");
      }

      const x = data.map(item => item.date);
      const y = data.map(item => item[field]);

      Plotly.newPlot("chart", [{
        x: x,
        y: y,
        type: "scatter",
        mode: "lines",
        line: { color: "#1F7120", width: 2 },
        name: field.toUpperCase()
      }], {
        paper_bgcolor: "#18181D",
        plot_bgcolor: "#18181D",
        font: { color: "white" },
        xaxis: { gridcolor: "#212127", zerolinecolor: "#212127" },
        yaxis: { gridcolor: "#212127", zerolinecolor: "#212127" },
        margin: { t: 10, b: 50 },
        legend: { orientation: "h", x: 0.5, xanchor: "center", y: -0.2 }
      });
    })
    .catch(err => showError("Error loading MVRV: " + err.message));
</script>
</body>
</html>
