<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
    }

    #chart {
      width: 100%;
      max-width: 1000px;
      margin: 0 auto;
    }

    #logo-front {
      display: none; /* No longer needed visually */
    }
  </style>
</head>
<body>
  <div id="chart"></div>

  <script>
    // Simulated data
    const priceData = [
      { date: '2022-01-01', price: 45000 },
      { date: '2022-01-02', price: 46000 },
      { date: '2022-01-03', price: 47000 },
      { date: '2022-01-04', price: 46500 },
      { date: '2022-01-05', price: 48000 }
    ];

    const mvrvData = [
      { date: '2022-01-01', mvrv: 1.2 },
      { date: '2022-01-02', mvrv: 1.3 },
      { date: '2022-01-03', mvrv: 1.5 },
      { date: '2022-01-04', mvrv: 1.4 },
      { date: '2022-01-05', mvrv: 1.6 }
    ];

    function getColorForMVRV(mvrv) {
      if (mvrv < 1.3) return 'blue';
      if (mvrv < 1.5) return 'green';
      return 'red';
    }

    function buildTraces(priceData, mvrvData) {
      const traces = [];

      // Price trace
      traces.push({
        x: priceData.map(d => d.date),
        y: priceData.map(d => d.price),
        type: 'scatter',
        mode: 'lines',
        name: 'Price',
        line: { color: 'black', width: 2 },
        hovertemplate: '%{x|%Y-%m-%d}<br><b>Price:</b> $%{y}<extra></extra>',
        yaxis: 'y1'
      });

      // MVRV gradient segments (not hoverable)
      for (let i = 1; i < mvrvData.length; i++) {
        const prev = mvrvData[i - 1];
        const curr = mvrvData[i];
        const color = getColorForMVRV(curr.mvrv);

        traces.push({
          x: [prev.date, curr.date],
          y: [prev.mvrv, curr.mvrv],
          yaxis: 'y2',
          type: 'scatter',
          mode: 'lines',
          line: { color: color, width: 2 },
          name: undefined,
          showlegend: false,
          hoverinfo: 'skip',
          legendgroup: 'mvrv',
          visible: true
        });
      }

      // Transparent MVRV trace for tooltip and legend toggle
      traces.push({
        x: mvrvData.map(d => d.date),
        y: mvrvData.map(d => d.mvrv),
        yaxis: 'y2',
        type: 'scatter',
        mode: 'markers',
        marker: { color: 'rgba(0,0,0,0)', size: 6 },
        hovertemplate: '%{x|%Y-%m-%d}<br><b>MVRV:</b> %{y:.3f}<extra></extra>',
        name: 'MVRV',
        showlegend: true,
        legendgroup: 'mvrv',
        visible: true
      });

      return traces;
    }

    const traces = buildTraces(priceData, mvrvData);

    const layout = {
      title: 'Price & MVRV Chart',
      xaxis: { title: 'Date' },
      yaxis: { title: 'Price', side: 'left' },
      yaxis2: {
        title: 'MVRV',
        overlaying: 'y',
        side: 'right'
      },
      images: [
        {
          source: "logo.png",  // Use full URL or base64 if external hosting fails
          xref: "paper",
          yref: "paper",
          x: 1,
          y: 1,
          sizex: 0.3,
          sizey: 0.3,
          xanchor: "right",
          yanchor: "top",
          opacity: 0.7,
          layer: "above"
        }
      ],
      margin: { t: 60, b: 40 },
      legend: { orientation: "h", x: 0.5, xanchor: "center", y: -0.2 }
    };

    Plotly.newPlot('chart', traces, layout);
  </script>
</body>
</html>
